<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|Monaco:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="于成辉的技术博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="于成辉的技术博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="于成辉的技术博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> 于成辉的技术博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">于成辉的技术博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">技术人生</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/16/2018-05-16-python-slice-introductions/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/16/2018-05-16-python-slice-introductions/" itemprop="url">
                  详解Python中的切片
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-16T15:19:55+08:00">
                2018-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h2 id="对象的切片"><a href="#对象的切片" class="headerlink" title="对象的切片"></a><strong>对象的切片</strong></h2><h3 id="切片的基本形式"><a href="#切片的基本形式" class="headerlink" title="切片的基本形式"></a><strong>切片的基本形式</strong></h3><p>在Python中，像列表（list）、元组（tuple）和字符串（str）这类的序列类型都支持切片操作，<strong><em>在切片和区间操作里不包含区间范围的最后一个元素是Python的风格</em></strong>，原因如下：</p>
<ul>
<li><p>当只有一个位置信息的时候，可以快速的看出切片和区间里有几个元素：<code>range(3)</code>和<code>my_list[:3]</code>都将返回3个元素</p>
</li>
<li><p>起止位置信息可见的时候，可以快速的计算出切片和区间的长度，用后一个数减去第一个下标即可<code>(stop - start)</code>即可</p>
</li>
<li><p>可以用任意一个下标把序列分割成不可重叠的部分，只要写成<code>my_list[:3]</code>和<code>my_list[3:]</code>即可</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>my_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>my_list[:<span class="number">5</span>]</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>my_list[<span class="number">5</span>:]</div><div class="line">[<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</div></pre></td></tr></table></figure>
<p>切片最常用的形式是：用<code>s[a:b:c]</code>的形式对<code>s</code>在<code>a</code>和<code>b</code>之间以<code>c</code>为间隔取值，当然<code>c</code>的值可以为负值，负值意味着反向取值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'abcdefghijk'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[::<span class="number">3</span>]</div><div class="line"><span class="string">'adgj'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[::<span class="number">-2</span>]</div><div class="line"><span class="string">'kigeca'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[::<span class="number">-1</span>]</div><div class="line"><span class="string">'kjihgfedcba'</span></div></pre></td></tr></table></figure>
<h3 id="切片对象"><a href="#切片对象" class="headerlink" title="切片对象"></a><strong>切片对象</strong></h3><p><code>a:b:c</code>这种用法只能作为索引或者下标用在<code>[]</code>中来返回一个<strong>切片对象</strong>：<code>slice(a,b,c)</code>，即可以用下面比较标准的表达方式进行说明。</p>
<p><code>seq[start:end:step]</code>对应的对象为<code>seq.__getitem__(slice(start,end,step))</code>，这个内置的序列类型也可以用户进行自定义。</p>
<h3 id="切片的赋值"><a href="#切片的赋值" class="headerlink" title="切片的赋值"></a><strong>切片的赋值</strong></h3><p>如果把切片放在赋值语句的左边，或者把它作为<code>del</code>的操作对象，就可以对序列进行嫁接，切除和修改，需要注意的是：<strong><em>如果赋值的对象是一个切片，那么赋值语句的右侧必须是个可迭代的对象，即便只有单独的一个值，也要把它转换成可迭代的对象</em></strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>l = list(range(<span class="number">10</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l</div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">3</span>] = [<span class="number">222</span>, <span class="number">333</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l</div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">222</span>, <span class="number">333</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">3</span>] = <span class="number">100</span>   </div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">TypeError: can only assign an iterable</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">3</span>] = [<span class="number">100</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l</div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">100</span>, <span class="number">333</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure>
<p>由于<code>100</code>不是一个可迭代的对象，所以直接给切片赋值的时候会出现报错，换成可迭代对象<code>[100]</code>后就不会再出错。如果在实现类的时候将内置的方法自定义为可迭代的对象后面会有详细的说明。</p>
<h2 id="切片的原理"><a href="#切片的原理" class="headerlink" title="切片的原理"></a><strong>切片的原理</strong></h2><p>先从一个例子说起：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">MySeq</span><span class="params">()</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> index</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = MySeq()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]</div><div class="line"><span class="number">1</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">5</span>]</div><div class="line">slice(<span class="number">1</span>, <span class="number">5</span>, <span class="keyword">None</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>]</div><div class="line">slice(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>, <span class="number">9</span>]</div><div class="line">(slice(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>), <span class="number">9</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>, <span class="number">4</span>:<span class="number">9</span>]</div><div class="line">(slice(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>), slice(<span class="number">4</span>, <span class="number">9</span>, <span class="keyword">None</span>))</div></pre></td></tr></table></figure>
<p>在输入<code>s[1:5:2]</code>默认的就会直接调用切片的对象，<code>slice(1, 5, 2)</code>，即从1开始，到5结束，步幅为2，如果<code>[]</code>中有逗号，那么<code>__getitem__</code>得到的是元组，下面来看看<code>slice</code>类的属性。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; slice  </div><div class="line">&lt;class 'slice'&gt;   ##表明slice是内置的类型</div><div class="line">&gt;&gt;&gt; dir(slice)</div><div class="line">['__class__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', 'indices', 'start', 'step', 'stop']</div><div class="line">&gt;&gt;&gt;</div><div class="line">&gt;&gt;&gt; help(slice.indices) ## 来看看slice的indices的属性</div><div class="line"></div><div class="line">indices(...)</div><div class="line">    S.indices(len) -&gt; (start, stop, stride)</div><div class="line"></div><div class="line">    Assuming a sequence of length len, calculate the start and stop</div><div class="line">    indices, and the stride length of the extended slice described by</div><div class="line">    S. Out of bounds indices are clipped in a manner consistent with the</div><div class="line">    handling of normal slices.</div></pre></td></tr></table></figure>
<p>上述方法说明，<code>indices</code>方法可以处理缺失的索引和负值，以及长度超过目标序列的切片，即将<code>start</code>，<code>stop</code>和<code>step</code>都变成非负数，并且都落在指定的长度序列的边界内。</p>
<h2 id="类的切片"><a href="#类的切片" class="headerlink" title="类的切片"></a><strong>类的切片</strong></h2><p>为了比较好的说明，先编写一个<code>Vector</code>的类，这个类自定义了内置的方法，其中就有关于切片的方法<code>__getitem__</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></div><div class="line">    typecode = <span class="string">'d'</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, components)</span>:</span></div><div class="line">        self._components = array(self.typecode, components)</div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> iter(self._components)</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></div><div class="line">        components = reprlib.repr(self._components)</div><div class="line">        components = components[components.find(<span class="string">'['</span>):<span class="number">-1</span>]</div><div class="line">        <span class="keyword">return</span> <span class="string">'Vector(&#123;&#125;)'</span>.format(components)</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> str(tuple(self._components))</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> len(self._components)</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></div><div class="line">        <span class="keyword">return</span> self._components[index]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1</div><div class="line">Vector([<span class="number">2.0</span>, <span class="number">4.0</span>, <span class="number">6.0</span>, <span class="number">8.0</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>len(v1)</div><div class="line"><span class="number">4</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v2 = Vector(range(<span class="number">9</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v2[<span class="number">2</span>:<span class="number">7</span>]</div><div class="line">array(<span class="string">'d'</span>, [<span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>])</div></pre></td></tr></table></figure>
<p>从上面的结果可以看出，<code>Vector</code>可以支持切片的操作，但是<code>Vector</code>实例的切片只是数组，如果结果也是<code>Vector</code>实例就比较完美了，下面给出具体的实现方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> array <span class="keyword">import</span> array</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> reprlib</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numbers</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></div><div class="line"><span class="meta">... </span>    typecode = <span class="string">'d'</span></div><div class="line">...</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, components)</span>:</span></div><div class="line"><span class="meta">... </span>        self._components = array(self.typecode, components)</div><div class="line">...</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> iter(self._components)</div><div class="line">...</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        components = reprlib.repr(self._components)</div><div class="line"><span class="meta">... </span>        components = components[components.find(<span class="string">'['</span>):<span class="number">-1</span>]</div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">'Vector(&#123;&#125;)'</span>.format(components)</div><div class="line">...</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> str(tuple(self._components))</div><div class="line">...</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> len(self._components)</div><div class="line"></div><div class="line"><span class="meta">... </span>    <span class="comment">#实现类的切片内置函数</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></div><div class="line">            <span class="comment"># 获取实例所属的类（即Vector），供后面使用</span></div><div class="line"><span class="meta">... </span>        cls = type(self)</div><div class="line">            <span class="comment"># 如果index参数的值是slice对象</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">if</span> isinstance(index, slice):</div><div class="line">                <span class="comment"># 调用类的构造方法，使用_components数组的切片构建一个新的Vector实例</span></div><div class="line"><span class="meta">... </span>            <span class="keyword">return</span> cls(self._components[index])</div><div class="line">            <span class="comment"># 如果index是int或者是其他的整数类型</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">elif</span> isinstance(index, numbers.Integral):</div><div class="line">                <span class="comment">#就返回_components中相应的元素</span></div><div class="line"><span class="meta">... </span>            <span class="keyword">return</span> self._components[index]</div><div class="line"><span class="meta">... </span>        <span class="keyword">else</span>:</div><div class="line"><span class="meta">... </span>            msg = <span class="string">'&#123;cls.__name__&#125; indices must be integers'</span></div><div class="line"><span class="meta">... </span>            <span class="keyword">raise</span> TypeError(msg.format(cls = cls))</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector(range(<span class="number">10</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1</div><div class="line">Vector([<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, ...])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1[<span class="number">-1</span>]</div><div class="line"><span class="number">9.0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1[<span class="number">2</span>:<span class="number">6</span>]</div><div class="line">Vector([<span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1[<span class="number">6</span>]</div><div class="line"><span class="number">6.0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>v1[<span class="number">1</span>,<span class="number">2</span>]</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">29</span>, <span class="keyword">in</span> __getitem__</div><div class="line">TypeError: Vector indices must be integers</div></pre></td></tr></table></figure>
<p>可以看出对<code>Vector</code>实例进行切片结果还是<code>Vector</code>实例，切片索引创建一个新的<code>Vector</code>实例，长度为1的切片也创建一个<code>Vector</code>实例。</p>
<p>参考文献：《流畅的Python》<br>[巴西] Luciano Ramalho 著<br>       安道  吴珂 译<br>       中国工信出版集团 人民邮电出版社</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/13/2018-05-13-python-static-class-abstract-methods/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/13/2018-05-13-python-static-class-abstract-methods/" itemprop="url">
                  详解Python中的类方法，静态方法和抽象方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-13T12:37:22+08:00">
                2018-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h2 id="Python中三种方法的工作原理"><a href="#Python中三种方法的工作原理" class="headerlink" title="Python中三种方法的工作原理"></a><strong>Python中三种方法的工作原理</strong></h2><p>方法是作为类中的一个属性，通过定义函数来进行实现，下面举例来说明。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></div><div class="line"><span class="meta">... </span>        self.size = size</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">get_size</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> self.size</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza.get_size</div><div class="line">&lt;unbound method Pizza.get_size&gt;</div></pre></td></tr></table></figure>
<p>上述的方法表明，类<code>Pizza</code>的属性<code>get_size</code>是一个<code>unbound</code>方法。下面来看另外一种调用方式。</p>
<blockquote>
<p>注1：上述的结果是在Python2.7的版本中进行试验的，在Python3.4版本中，会提示<code>&lt;function __main__.Pizza.get_size&gt;</code>，说明是一种main函数，但这并不会影响相关概念的说明。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza.get_size()</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">TypeError: unbound method get_size() must be called <span class="keyword">with</span> Pizza instance <span class="keyword">as</span> first argument (got nothing instead)</div></pre></td></tr></table></figure>
<p>上述调用的问题主要在于属性方法<code>get_size</code>并没有和任何<code>Pizza</code>的实例进行绑定，一个方法需要一个实例作为它的第一个参数（在Python2中，必须是一个类的实例，在Python3中可以是任意的赋值），接着来进行如下调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza.get_size(Pizza(<span class="number">42</span>))</div><div class="line"><span class="number">42</span></div></pre></td></tr></table></figure>
<p>正常的运行！在调用方法的时候我们将一个类的实例作为第一个参数传入，所以一切正常。上述的实验表明，<strong>我们在调用一个方法的时候，总是需要参照类的实现，如果我们并不知道哪个类是我们的对象，这种方式调用方法并不是特别的有效</strong></p>
<p>正是由于上述的缺点，Python已经有相关的解决方案，<strong>将类Pizza的所有方法绑定到该类的任意一个实例上</strong>，这就意味着类<code>Pizza</code>的实例的属性<code>get_size</code>就是一个绑定的方法，即<strong>该方法的第一个传入的参数将会是它自己的实例</strong>，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza(<span class="number">42</span>).get_size</div><div class="line">&lt;bound method Pizza.get_size of &lt;__main__.Pizza object at <span class="number">0x7f3138827910</span>&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza(<span class="number">42</span>).get_size()</div><div class="line"><span class="number">42</span></div></pre></td></tr></table></figure>
<p>从上述的结果来看，我们并不需要给绑定的方法<code>get_size</code>传入任何参数，它的<code>self</code>参数会自动的设置给<code>Pizza</code>实例，可以通过下面的实验进行说明：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>m = Pizza(<span class="number">42</span>).get_size</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m()</div><div class="line"><span class="number">42</span></div></pre></td></tr></table></figure>
<p>实际上，你都不需要保持对<code>Pizza</code>对象的引用，它的方法已经绑定到object上，仅仅使用这个方法本身就已经足够了。如果想知道已经绑定的方法具体绑定到哪个object上，下面有一个小的技巧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>m = Pizza(<span class="number">42</span>).get_size</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m.__self__</div><div class="line">&lt;__main__.Pizza object at <span class="number">0x7f3138827910</span>&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 进一步检验</span></div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m == m.__self__.get_size</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure>
<p>很明显的看出，我们仍然对object存在引用，并且可以比较容易的查出具体是哪个object。<br>在Python3中，类中的函数已经不再作为绑定方法存在了，但是对于简单的函数来说，仍然可以绑定到一个object上，上述的规则仍然有效。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></div><div class="line"><span class="meta">... </span>        self.size = size</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">get_size</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>        <span class="keyword">return</span> self.size</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza.get_size</div><div class="line">&lt;function Pizza.get_size at <span class="number">0x7f307f984dd0</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="静态方法（Static-methods）"><a href="#静态方法（Static-methods）" class="headerlink" title="静态方法（Static methods）"></a><strong>静态方法（Static methods）</strong></h2><p>静态方法是方法的特例。有时你会编写属于某个类的代码，但根本不使用该对象本身。 例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">    @staticmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mix_ingredients</span><span class="params">(x, y)</span>:</span></div><div class="line">        <span class="keyword">return</span> x + y</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cook</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.mix_ingredients(self.cheese, self.vegetables)</div></pre></td></tr></table></figure>
<p>上述例子中，也可以将<code>mix_ingredients</code>作为一个非静态方法来进行使用，但是这样会提供给<code>mix_ingredients</code>一个<code>self</code>的参数，这个参数也不会被用到。综上所述，装饰器<code>@staticmethod</code>将会给我们带来以下的好处：</p>
<ul>
<li>Python不必为我们实例化的每个<code>Pizza</code>对象再实例化一个绑定方法。 绑定的方法也是对象，创建它们会带来成本，而静态方法避免了这一点；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza().cook <span class="keyword">is</span> Pizza().cook</div><div class="line"><span class="keyword">False</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza().mix_ingredients <span class="keyword">is</span> Pizza.mix_ingredients</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza().mix_ingredients <span class="keyword">is</span> Pizza().mix_ingredients</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure>
<ul>
<li><p>它简化了代码的可读性：看到<code>@staticmethod</code>，我们知道该方法不依赖于对象本身的状态;</p>
</li>
<li><p>它允许我们重载子类中的<code>mix_ingredients</code>方法。 如果我们使用在父类<code>Pizza</code>中定义函数<code>mix_ingredients</code>，而不重载<code>cook</code>函数，那么从Pizza继承的子类将无法改变我们对<code>Pizza</code>的混合方式</p>
</li>
</ul>
<h2 id="类方法（Class-methods）"><a href="#类方法（Class-methods）" class="headerlink" title="类方法（Class methods）"></a><strong>类方法（Class methods）</strong></h2><p>什么是类方法？类方法就是绑定到类上而不是对象上的方法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; class Pizza(object):</div><div class="line">...     radius = 42</div><div class="line">...     @classmethod</div><div class="line">...     def get_radius(cls):</div><div class="line">...         return cls.radius</div><div class="line">... </div><div class="line">&gt;&gt;&gt; </div><div class="line">&gt;&gt;&gt; Pizza.get_radius</div><div class="line">&lt;bound method type.get_radius of &lt;class '__main__.Pizza'&gt;&gt;</div><div class="line">&gt;&gt;&gt; Pizza().get_radius</div><div class="line">&lt;bound method type.get_radius of &lt;class '__main__.Pizza'&gt;&gt;</div><div class="line">&gt;&gt;&gt; Pizza.get_radius is Pizza().get_radius</div><div class="line">True</div><div class="line">&gt;&gt;&gt; Pizza.get_radius()</div><div class="line">42</div></pre></td></tr></table></figure>
<p>不管你用什么方式调用这个方法，它总是被绑定到它所属的类上，它的第一个参数将是类本身（记住类也是对象）。<br>类方法主要用于两种类型的方法：</p>
<ul>
<li>工厂方法，用于使用例如某种预处理为类创建实例。 如果我们使用<code>@staticmethod</code>代替，我们必须在我们的函数中对<code>Pizza</code>类的名称进行硬编码，使得任何继承自Pizza的类都无法使用我们的工厂方法供自己使用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, ingredients)</span>:</span></div><div class="line">        self.ingredients = ingredients</div><div class="line"></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_fridge</span><span class="params">(cls, fridge)</span>:</span></div><div class="line">        <span class="keyword">return</span> cls(fridge.get_cheese() + fridge.get_vegetables())</div></pre></td></tr></table></figure>
<ul>
<li>用静态的方式调用静态方法：如果你将一个静态的方法分散到多个静态方法中的时候，你在使用类方法的时候不需要对类的名字进行硬编码（即不需要直接使用类的名字）。例如说下面的例子，<code>Pizza</code>的名字不需要直接使用和继承，重载的类方法仍然可以十分有效的被使用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, radius, height)</span>:</span></div><div class="line">        self.radius = radius</div><div class="line">        self.height = height</div><div class="line"></div><div class="line"><span class="meta">    @staticmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_area</span><span class="params">(radius)</span>:</span></div><div class="line">         <span class="keyword">return</span> math.pi * (radius ** <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_volume</span><span class="params">(cls, height, radius)</span>:</span></div><div class="line">         <span class="keyword">return</span> height * cls.compute_area(radius)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_volume</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.compute_volume(self.height, self.radius)</div></pre></td></tr></table></figure>
<h2 id="抽象方法（Abstract-methods）"><a href="#抽象方法（Abstract-methods）" class="headerlink" title="抽象方法（Abstract methods）"></a><strong>抽象方法（Abstract methods）</strong></h2><p>抽象方法是在基类中定义的方法，但可能不提供任何实现。 在Java中，主要用来描述接口，在Python中编写抽象方法最简单的方式是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_radius</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">raise</span> NotImplementedError</div></pre></td></tr></table></figure>
<p>任何继承自<code>Pizza</code>的类都应该实现并覆盖<code>get_radius</code>方法，否则会引发异常。<br>这种实现抽象方法的特殊方式有一个缺点，即如果您编写一个继承自<code>Pizza</code>的类并忘记实现<code>get_radius</code>，则只会在使用该方法时引发错误。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza()</div><div class="line">&lt;__main__.Pizza object at <span class="number">0x7fb747353d90</span>&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Pizza().get_radius()</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">3</span>, <span class="keyword">in</span> get_radius</div><div class="line">NotImplementedError</div></pre></td></tr></table></figure>
<p>Python中的<code>abc</code>模块可以避免上述的问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> abc</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePizza</span><span class="params">(object)</span>:</span></div><div class="line">    __metaclass__ = abc.ABCMeta</div><div class="line"></div><div class="line"><span class="meta">    @abc.abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_radius</span><span class="params">(self)</span>:</span></div><div class="line">         <span class="string">"""Method that should do something."""</span></div></pre></td></tr></table></figure>
<p>使用<code>abc</code>及其特殊类，在尝试实例化<code>BasePizza</code>或从中继承任何类的时候，只要使用<code>abc</code>以及其特殊的类，就会得到一个TypeError。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>BasePizza()</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">TypeError: Can<span class="string">'t instantiate abstract class BasePizza with abstract methods get_radius</span></div></pre></td></tr></table></figure>
<h2 id="类方法，静态方法和抽象方法的结合"><a href="#类方法，静态方法和抽象方法的结合" class="headerlink" title="类方法，静态方法和抽象方法的结合"></a><strong>类方法，静态方法和抽象方法的结合</strong></h2><p>当构建类和继承类时，声明为抽象类的方法不会冻结该方法的原型。这意味着该抽象方法可以用任何的参数列表进行实现，而且是必须要实现的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> abc</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePizza</span><span class="params">(object)</span>:</span></div><div class="line">    __metaclass__  = abc.ABCMeta</div><div class="line"></div><div class="line"><span class="meta">    @abc.abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">(self)</span>:</span></div><div class="line">         <span class="string">"""Returns the ingredient list."""</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Calzone</span><span class="params">(BasePizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">(self, with_egg=False)</span>:</span></div><div class="line">        egg = Egg() </div><div class="line">        <span class="keyword">if</span> with_egg <span class="keyword">else</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">return</span> self.ingredients + egg</div></pre></td></tr></table></figure>
<p>这是有效的，因为<code>Calzone</code>满足我们为<code>BasePizza</code>对象定义的接口要求。这意味着我们也可以将它实现为类或静态方法，例如：       </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> abc</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePizza</span><span class="params">(object)</span>:</span></div><div class="line">    __metaclass__  = abc.ABCMeta</div><div class="line"></div><div class="line"><span class="meta">    @abc.abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">(self)</span>:</span></div><div class="line">         <span class="string">"""Returns the ingredient list."""</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DietPizza</span><span class="params">(BasePizza)</span>:</span></div><div class="line"><span class="meta">    @staticmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">()</span>:</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div></pre></td></tr></table></figure>
<p>这也是正确的，符合<code>BasePizza</code>抽象类的定义。 <code>get_ingredients</code>方法并不需要知道object是通过具体实现才能返回结果的细节部分。因此，你不能强制抽象方法的实现是一个类方法或静态方法。 从Python 3开始，可以在<code>@abstractmethod</code>上使用<code>@staticmethod</code>和<code>@classmethod</code>装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> abc</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePizza</span><span class="params">(object)</span>:</span></div><div class="line">    __metaclass__  = abc.ABCMeta</div><div class="line"></div><div class="line">    ingredient = [<span class="string">'cheese'</span>]</div><div class="line"></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line"><span class="meta">    @abc.abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">(cls)</span>:</span></div><div class="line">         <span class="string">"""Returns the ingredient list."""</span></div><div class="line">         <span class="keyword">return</span> cls.ingredients</div></pre></td></tr></table></figure>
<p>不要误解这一点：如果你认为这将迫使你的子类实现<code>get_ingredients</code>作为类方法，那么你错了。这只是意味着你在<code>BasePizza</code>类中实现<code>get_ingredients</code>是一种类方法。<br>在抽象类中进行实现也是可以的，Python中，与Java接口中的方法相反，可以在抽象方法中进行编码并通过<code>super()</code>调用它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> abc</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePizza</span><span class="params">(object)</span>:</span></div><div class="line">    __metaclass__  = abc.ABCMeta</div><div class="line"></div><div class="line">    default_ingredients = [<span class="string">'cheese'</span>]</div><div class="line"></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line"><span class="meta">    @abc.abstractmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">(cls)</span>:</span></div><div class="line">         <span class="string">"""Returns the ingredient list."""</span></div><div class="line">         <span class="keyword">return</span> cls.default_ingredients</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DietPizza</span><span class="params">(BasePizza)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ingredients</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> [<span class="string">'egg'</span>] + super(DietPizza, self).get_ingredients()</div></pre></td></tr></table></figure>
<p>在这种情况下，通过从<code>BasePizza</code>继承而构建的每个<code>pizza</code>必须覆盖<code>get_ingredients</code>方法，但是可以通过使用<code>super()</code>来获取<code>ingredient</code>列表。</p>
<p>翻译自<a href="https://julien.danjou.info/guide-python-static-class-abstract-methods/" target="_blank" rel="external">这里</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/13/2018-04-13-python-random/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/04/13/2018-04-13-python-random/" itemprop="url">
                  Python中生成随机数的方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-13T11:38:53+08:00">
                2018-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>在Python中用于生成随机数的模块是<code>random</code>模块</p>
<h3 id="random-random"><a href="#random-random" class="headerlink" title="random.random"></a><em>random.random</em></h3><p><code>random.random()</code>:生成一个0到1之间的随机浮点数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line">random.random()</div><div class="line"></div><div class="line"><span class="comment"># 0.13675603259835079</span></div></pre></td></tr></table></figure>
<h3 id="random-uniform"><a href="#random-uniform" class="headerlink" title="random.uniform"></a><em>random.uniform</em></h3><p><code>random.uniform(a, b)</code>:生成[a,b]之间的浮点数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random  </div><div class="line"><span class="keyword">print</span> random.uniform(<span class="number">0</span>, <span class="number">5</span>)</div><div class="line"></div><div class="line"><span class="comment"># 1.32796442555</span></div></pre></td></tr></table></figure>
<h3 id="random-randint"><a href="#random-randint" class="headerlink" title="random.randint"></a><em>random.randint</em></h3><p><code>random.randint(a, b)</code>:生成[a,b]之间的整数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random  </div><div class="line"><span class="keyword">print</span> random.randint(<span class="number">1</span>, <span class="number">5</span>)</div><div class="line"></div><div class="line"><span class="comment"># 4</span></div></pre></td></tr></table></figure>
<h3 id="random-randrange"><a href="#random-randrange" class="headerlink" title="random.randrange"></a><em>random.randrange</em></h3><p><code>random.randrange(a, b, step)</code>:在指定的集合<code>[a,b)</code>中,以<code>step</code>为基数随机取一个数.如<code>random.randrange(0, 20, 2)</code>,相当于从<code>[0,2,4,6,…,18]</code>中随机取一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random  </div><div class="line"><span class="keyword">print</span> random.randrange(<span class="number">0</span>, <span class="number">20</span>, <span class="number">2</span>)  </div><div class="line"></div><div class="line"><span class="comment"># 14</span></div></pre></td></tr></table></figure>
<h3 id="random-choice"><a href="#random-choice" class="headerlink" title="random.choice"></a><em>random.choice</em></h3><p><code>random.choice(sequence)</code>:从特定序列中随机取一个元素,这里的序列可以是字符串,列表,元组等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random  </div><div class="line">string = <span class="string">'nice to meet you'</span>  </div><div class="line">tup = (<span class="string">'nice'</span>, <span class="string">'to'</span>, <span class="string">'meet'</span>, <span class="string">'you'</span>)  </div><div class="line">lst = [<span class="string">'nice'</span>, <span class="string">'to'</span>, <span class="string">'meet'</span>, <span class="string">'you'</span>]  </div><div class="line">dic = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;  </div><div class="line"><span class="keyword">print</span> random.choice(string)  </div><div class="line"><span class="keyword">print</span> random.choice(tup)  </div><div class="line"><span class="keyword">print</span> random.choice(lst)  </div><div class="line"><span class="keyword">print</span> random.choice(dic.keys())</div><div class="line"></div><div class="line"><span class="comment">#c </span></div><div class="line"><span class="comment">#meet </span></div><div class="line"><span class="comment">#nice </span></div><div class="line"><span class="comment">#c</span></div></pre></td></tr></table></figure>
<h3 id="random-shuffle"><a href="#random-shuffle" class="headerlink" title="random.shuffle"></a><em>random.shuffle</em></h3><p><code>random.shuffle(lst)</code>:将列表中的元素打乱,洗牌</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random  </div><div class="line">lst = [<span class="string">'nice'</span>, <span class="string">'to'</span>, <span class="string">'meet'</span>, <span class="string">'you'</span>]  </div><div class="line">random.shuffle(lst)  </div><div class="line"><span class="keyword">print</span> lst </div><div class="line"> </div><div class="line"><span class="comment">#['you', 'nice', 'to', 'meet']</span></div></pre></td></tr></table></figure>
<h3 id="random-sample"><a href="#random-sample" class="headerlink" title="random.sample"></a><em>random.sample</em></h3><p><code>random.sample(sequence,k)</code>:从指定序列在随机抽取定长序列,原始序列不变,例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random  </div><div class="line">string = <span class="string">'nice to meet you'</span>  </div><div class="line">tup = (<span class="string">'nice'</span>, <span class="string">'to'</span>, <span class="string">'meet'</span>, <span class="string">'you'</span>)  </div><div class="line">lst = [<span class="string">'nice'</span>, <span class="string">'to'</span>, <span class="string">'meet'</span>, <span class="string">'you'</span>]  </div><div class="line">dic = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;  </div><div class="line"><span class="keyword">print</span> random.sample(string, <span class="number">2</span>)  </div><div class="line"><span class="keyword">print</span> random.sample(tup, <span class="number">2</span>)  </div><div class="line"><span class="keyword">print</span> random.sample(lst, <span class="number">2</span>)  </div><div class="line"></div><div class="line"><span class="comment">#['m', 'i'] </span></div><div class="line"><span class="comment">#['you', 'nice'] </span></div><div class="line"><span class="comment">#['nice', 'to']</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/29/2018-03-29-python-import-mechanism-md/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/29/2018-03-29-python-import-mechanism-md/" itemprop="url">
                  Python的import机制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-29T08:55:48+08:00">
                2018-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<blockquote>
<p>说明：在有关<code>__name__</code>和<code>__main__</code>的<a href="https://chenghuiyu.github.io/2018/03/28/2018-03-28-python-name-main-md/" target="_blank" rel="external">博文</a>中已经简单的介绍过import的使用，本篇博客会对import机制进行更为详尽的介绍。</p>
</blockquote>
<h2 id="模块与包"><a href="#模块与包" class="headerlink" title="模块与包"></a>模块与包</h2><h2 id="两种形式的-import"><a href="#两种形式的-import" class="headerlink" title="两种形式的 import"></a>两种形式的 import</h2><h2 id="import-的搜索路径"><a href="#import-的搜索路径" class="headerlink" title="import 的搜索路径"></a>import 的搜索路径</h2><h2 id="相对-import-与-绝对-import"><a href="#相对-import-与-绝对-import" class="headerlink" title="相对 import 与 绝对 import"></a>相对 import 与 绝对 import</h2><pre><code>◦    相对 import
◦    绝对 import
◦    两者的差异
•    import 的大致过程
•    Tips
•    参考
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/28/2018-03-28-python-name-main-md/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/28/2018-03-28-python-name-main-md/" itemprop="url">
                  Python中的__name__和__main__的含义详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-28T10:24:03+08:00">
                2018-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<blockquote>
<p>说明：在写Python中module的时候，会有以下的习惯方式，下面来说明<code>__name__</code>和<code>__main__</code>两个的具体含义。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">    ...</div><div class="line">    </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    func()</div></pre></td></tr></table></figure>
<h2 id="name-的含义"><a href="#name-的含义" class="headerlink" title="__name__的含义"></a><code>__name__</code>的含义</h2><p>一般来说<code>__name__</code>的含义一般有一下两种方式：</p>
<ul>
<li>如果是放在Modules模块中，就表示是模块的名字；</li>
<li>如果是放在Classs类中，就表示类的名字；</li>
</ul>
<h2 id="main-的含义："><a href="#main-的含义：" class="headerlink" title="__main__的含义："></a><code>__main__</code>的含义：</h2><p>模块第一次被导出（import）后，系统会自动为其创建一个域名空间（namespace）；模块，都是有自己的名字的）此处的脚本的主模块的名字，始终都叫做<code>__main__</code>。</p>
<h2 id="示例说明："><a href="#示例说明：" class="headerlink" title="示例说明："></a>示例说明：</h2><h3 id="创建直接运行的示例"><a href="#创建直接运行的示例" class="headerlink" title="创建直接运行的示例"></a>创建直接运行的示例</h3><p>创建Python文件<code>__name___and___main__.py</code>，具体如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># __name___and___main__.py</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">return</span> x * x</div><div class="line"><span class="keyword">print</span> (<span class="string">"test: square(42) =="</span>,square(<span class="number">42</span>))</div></pre></td></tr></table></figure>
<p>运行上述的程序，得到以下的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">➜ python __name___and___main__.py</div><div class="line">(&apos;test: square(42) ==&apos;, 1764)</div></pre></td></tr></table></figure>
<h3 id="import的方式导入module"><a href="#import的方式导入module" class="headerlink" title="import的方式导入module"></a>import的方式导入module</h3><p>创建Python文件<code>mypath.py</code>，具体内容和上面的<code>__name___and___main__.py</code>内容一致，但是函数<code>square()</code>是通过import的方式进行使用的，即<code>import mypath</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mypath.py</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">return</span> x * x</div><div class="line"><span class="keyword">print</span> (<span class="string">"test: square(42) =="</span>,square(<span class="number">42</span>))</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># __name___and___main__.py</span></div><div class="line"><span class="keyword">import</span> mypath</div><div class="line"></div><div class="line"><span class="keyword">print</span> (<span class="string">"In caller, test for mymath: square(12)="</span>,mymath.square(<span class="number">12</span>))</div></pre></td></tr></table></figure>
<p>运行文件<code>__name___and___main__.py</code>得到：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜ python __name___and___main__.py</div><div class="line">(<span class="string">'test: square(42) =='</span>, <span class="number">1764</span>)</div><div class="line">(<span class="string">'In caller, test for mymath: square(12)='</span>, <span class="number">144</span>)</div></pre></td></tr></table></figure></p>
<p>从上述的内容可以看出，原本在mypath.py中测试square中的结果也会被打印出来，这个是我们作为import的时候不希望看到的，作为模块<code>mypath.py</code>本身，希望有自己的相关的调试的代码，用于调试自己模块函数，演示如何使用等等代码；但是又不希望在被别的，本模块的调用者，所执行到，所看到；此时，就可以用上述的<code>__main__</code>来实现了：</p>
<p>将<code>mypath.py</code>的内容改写为下面的内容：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mypath.py</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">return</span> x * x</div><div class="line">    </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">print</span> (<span class="string">"test: square(42) =="</span>,square(<span class="number">42</span>))</div></pre></td></tr></table></figure></p>
<p>运行两个文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">➜  python mypath.py</div><div class="line">(<span class="string">'test: square(42) =='</span>, <span class="number">1764</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">➜  python __name___and___main__.py</div><div class="line">(<span class="string">'In caller, test for mymath: square(12)='</span>, <span class="number">144</span>)</div></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>其中的<code>__main__</code>，就是作为模块mypath.py本身，即：</p>
<ul>
<li>作为脚本自己去运行的话，对应的模块名，就是上面所解释的，始终叫做<code>__main__</code>，关于这点，上述代码已经验证过了。因为<code>mypath.py</code>中的<code>__name__</code>，就是对应的内置的变量，通过判断，的确是<code>__main__</code>，然后才会去执行到对应的模块的测试代码的。</li>
<li>如果被当做一个模块被别人调用的时候，对应的模块<code>mypath.py</code>的模块名，就是<code>mypath</code>；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/17/2017-12-17-Jupyter-install-deeplearning/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/17/2017-12-17-Jupyter-install-deeplearning/" itemprop="url">
                  使用Anaconda和jupyter notebook搭建TensorFlow环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-17T19:42:18+08:00">
                2017-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h3 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h3><p>到<a href="https://www.anaconda.com/downloads" target="_blank" rel="external">官网</a>下载安装文件，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bash Anaconda2-5.0.1-Linux-x86_64.sh #执行安装脚本</div></pre></td></tr></table></figure>
<p>在安装的过程中，直接按enter即可，如果遇到选择安装路径的选项，也可以自己设置路径。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~.bashrc</div></pre></td></tr></table></figure>
<p>如果使用的zsh</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim ~/.zshrc</div></pre></td></tr></table></figure>
<p>添加如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PATH=&quot;/home/some/anaconda/bin:$PATH&quot;</div></pre></td></tr></table></figure>
<h3 id="使用Anaconda"><a href="#使用Anaconda" class="headerlink" title="使用Anaconda"></a>使用Anaconda</h3><p>直接使用命令<em>conda</em>来使用Anaconda<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">conda install seaborn  #安装Python库</div><div class="line">conda install tensorfow #安装TensorFlow</div></pre></td></tr></table></figure></p>
<p>使用Anaconda创建虚拟环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">conda create --name tflab seaborn  #创建虚拟环境tflab，并在tflab里面安装seaborn</div><div class="line"></div><div class="line">source activate snowflakes #进入虚拟环境</div><div class="line">source deactivate #离开虚拟环境</div></pre></td></tr></table></figure></p>
<p>##安装jupyter notebook</p>
<p>如果安装好了Anaconda，那么就直接使用下面的命令安装jupyter notebook<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">conda update jupyter</div></pre></td></tr></table></figure></p>
<p>如果没有安装，则需要使用pip进行安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install jupyter</div></pre></td></tr></table></figure>
<p>生成jupyter notebook的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jupyter notebook --generate-config</div></pre></td></tr></table></figure>
<p>就会生成~/.jupyter/jupyter_notebook_config.py文件，下面对该文件的配置信息进行说明。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">c.NotebookApp.ip = &apos;172.16.0.185&apos;  #该选项可以设置远程连接地址，默认的值为localhost</div><div class="line">c.NotebookApp.notebook_dir = &apos;/home/some/jupyter_notebook&apos; #打开jupyter时的默认路径，这里可以自己设置</div><div class="line">c.NotebookApp.port = 8888 #默认开启的端口</div></pre></td></tr></table></figure>
<p>如果需要密码登陆，那么就用ipython生成密码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</div><div class="line">In [<span class="number">2</span>]: passwd()</div><div class="line">Enter password: </div><div class="line">Verify password: </div><div class="line">Out[<span class="number">2</span>]: <span class="string">'sha1:ce...'</span></div></pre></td></tr></table></figure>
<p>添加密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c.NotebookApp.password = u&apos;sha:ce...刚才复制的那个密文&apos;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/21/2017-10-21-install-tensorflow/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/21/2017-10-21-install-tensorflow/" itemprop="url">
                  安装TensorFlow
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-21T20:46:38+08:00">
                2017-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<blockquote>
<blockquote>
<p>操作系统：Ubuntu 16.4</p>
</blockquote>
</blockquote>
<h2 id="一-virtualenv安装"><a href="#一-virtualenv安装" class="headerlink" title="(一) virtualenv安装"></a><strong>(一) virtualenv安装</strong></h2><h3 id="安装virtualenv"><a href="#安装virtualenv" class="headerlink" title="安装virtualenv"></a><strong>安装virtualenv</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install python-pip python-dev python-virtualenv # for Python 2.7</div><div class="line"></div><div class="line">sudo apt-get install python3-pip python3-dev python-virtualenv # for Python 3.n</div></pre></td></tr></table></figure>
<h3 id="新建一个virtualenv环境"><a href="#新建一个virtualenv环境" class="headerlink" title="新建一个virtualenv环境"></a><strong>新建一个virtualenv环境</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">virtualenv --system-site-packages targetDirectory # for Python 2.7</div><div class="line"></div><div class="line">virtualenv --system-site-packages -p python3 targetDirectory # for Python 3.n</div></pre></td></tr></table></figure>
<p>其中，<em>targetDirectory</em>为本地搭建virtualenv的目录，这里取<em>~/tensorflow</em> 。</p>
<h3 id="进入到virtualenv环境中"><a href="#进入到virtualenv环境中" class="headerlink" title="进入到virtualenv环境中"></a><strong>进入到virtualenv环境中</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/tensorflow/bin/activate # bash, sh, ksh, or zsh</div></pre></td></tr></table></figure>
<h3 id="安装pip"><a href="#安装pip" class="headerlink" title="安装pip"></a><strong>安装pip</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(tensorflow) ➜  ~ easy_install -U pip</div></pre></td></tr></table></figure>
<h3 id="在virtualenv里面安装TensorFlow"><a href="#在virtualenv里面安装TensorFlow" class="headerlink" title="在virtualenv里面安装TensorFlow"></a><strong>在virtualenv里面安装TensorFlow</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> (tensorflow) ➜  ~ pip install --upgrade tensorflow</div><div class="line"></div><div class="line"> ... ...</div><div class="line"></div><div class="line">Successfully installed backports.weakref-1.0.post1 bleach-1.5.0 enum34-1.1.6 funcsigs-1.0.2 </div><div class="line">futures-3.2.0 html5lib-0.9999999 markdown-2.6.10 mock-2.0.0 numpy-1.13.3 pbr-3.1.1 </div><div class="line">protobuf-3.5.0.post1 six-1.11.0 tensorflow-1.4.1 tensorflow-tensorboard-0.4.0rc3 werkzeug-0.13</div></pre></td></tr></table></figure>
<h3 id="使用TensorFlow"><a href="#使用TensorFlow" class="headerlink" title="使用TensorFlow"></a><strong>使用TensorFlow</strong></h3><p>进入TensorFlow环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/tensorflow/bin/activate      # bash, sh, ksh, or zsh</div></pre></td></tr></table></figure>
<p>退出TensorFlow环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(tensorflow) ➜  deactivate</div></pre></td></tr></table></figure>
<p>推荐使用上述方法进行安装。</p>
<h2 id="二-docker安装"><a href="#二-docker安装" class="headerlink" title="(二) docker安装"></a><strong>(二) docker安装</strong></h2><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a><strong>安装docker</strong></h3><p>可在docker的官网[<a href="https://docs.docker.com]上安装docker" target="_blank" rel="external">https://docs.docker.com]上安装docker</a></p>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a><strong>获取镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker pull tensorflow/tensorflow:1.4.0-rc0</div><div class="line"># 最新版1.4.0-rc0为例</div></pre></td></tr></table></figure>
<h3 id="启动TensorFlow镜像"><a href="#启动TensorFlow镜像" class="headerlink" title="启动TensorFlow镜像 "></a><strong>启动TensorFlow镜像 </strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker run --name tflab  -p 8888:8888 -p 6006:6006  -v ~/tflab:/notebooks/tflab  -d tensorflow/tensorflow:1.4.0-rc0</div><div class="line"># --name 表示安装docker容器的名字，这里使用tflab</div><div class="line"># -p 8888:8888 表示主机8888端口映射到容器镜像的8888端口，可以进行设置，如果将本地的56映射，则改为56：8888</div><div class="line"># -v 表示将本地的地址映射为容器的地址</div><div class="line"># -d 指定镜像</div></pre></td></tr></table></figure>
<h3 id="获取Jupyter-Token并用浏览器-推荐Chrome-打开Jupyter实验环境"><a href="#获取Jupyter-Token并用浏览器-推荐Chrome-打开Jupyter实验环境" class="headerlink" title="获取Jupyter Token并用浏览器(推荐Chrome)打开Jupyter实验环境"></a><strong>获取Jupyter Token并用浏览器(推荐Chrome)打开Jupyter实验环境</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker logs tflab</div></pre></td></tr></table></figure>
<p>###<strong>新建一个Python2的Notebook</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">from tensorflow.contrib.keras import datasets</div><div class="line"></div><div class="line">datasets.mnist.load_data()</div><div class="line"></div><div class="line">print(&quot;\n Done&quot;)</div></pre></td></tr></table></figure>
<p>下载的文件会存放在容器内的 <em>/root/.keras/datasets</em>下面</p>
<p>到此，本地的docker安装TensorFlow就已经完成了，下面就可以进行TensorFlow试验。</p>
<h3 id="访问TensorBoard"><a href="#访问TensorBoard" class="headerlink" title="访问TensorBoard"></a><strong>访问TensorBoard</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker exec -it tflab bash #进入到docker的镜像</div><div class="line"></div><div class="line">tensorboard --logdir=/notebooks/tflab/logs # 启动TensorBoard进程</div></pre></td></tr></table></figure>
<p>通过<a href="http://localhost:6006/来访问TensorBoard" target="_blank" rel="external">http://localhost:6006/来访问TensorBoard</a></p>
<p>$$J = - \frac{1}{m} \sum\limits_{i = 0}^{m} \large\left(\small y^{(i)}\log\left(a^{[2] (i)}\right) + (1-y^{(i)})\log\left(1- a^{[2] (i)}\right)  \large  \right) \small \tag{6}$$</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/24/2017-08-24-systemd-introduction/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/24/2017-08-24-systemd-introduction/" itemprop="url">
                  Systemd介绍和实践总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-24T16:26:04+08:00">
                2017-08-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/操作系统/" itemprop="url" rel="index">
                    <span itemprop="name">操作系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h1 id="Systemd原理介绍"><a href="#Systemd原理介绍" class="headerlink" title="Systemd原理介绍"></a><strong>Systemd原理介绍</strong></h1><p>Systemd为系统的第一个进程，其他的进程都是它的子进程。</p>
<p>Systemd组成框图</p>
<img src="/images/systemd/Systemd-components.png">
<p>Systemd和Linux的cgroups之间的关系</p>
<img src="/images/systemd/Linux-cgroups-and-systemd.png">
<h1 id="systemd命令详解"><a href="#systemd命令详解" class="headerlink" title="systemd命令详解"></a><strong>systemd命令详解</strong></h1><h2 id="系统管理命令"><a href="#系统管理命令" class="headerlink" title="系统管理命令"></a><strong>系统管理命令</strong></h2><h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a><strong>systemctl</strong></h3><p><strong>作用</strong>：用于系统的管理</p>
<p>在root权限下进行使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># 重启系统</div><div class="line">$ systemctl reboot</div><div class="line"></div><div class="line"># 关闭系统，切断电源</div><div class="line">$ systemctl poweroff</div><div class="line"></div><div class="line"># CPU停止工作</div><div class="line">$ systemctl halt</div><div class="line"></div><div class="line"># 暂停系统</div><div class="line">$ systemctl suspend</div><div class="line"></div><div class="line"># 让系统进入冬眠状态</div><div class="line">$ systemctl hibernate</div><div class="line"></div><div class="line"># 让系统进入交互式休眠状态</div><div class="line">$ systemctl hybrid-sleep</div><div class="line"></div><div class="line"># 启动进入救援状态（单用户状态）</div><div class="line">$ systemctl rescue</div></pre></td></tr></table></figure>
<h3 id="systemd-analyze"><a href="#systemd-analyze" class="headerlink" title="systemd-analyze"></a><strong>systemd-analyze</strong></h3><p><strong>作用</strong>：用于查看启动耗时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 查看启动耗时</div><div class="line">$ systemd-analyze                                                                                       </div><div class="line"></div><div class="line"># 查看每个服务的启动耗时</div><div class="line">$ systemd-analyze blame</div><div class="line"></div><div class="line"># 显示瀑布状的启动过程流</div><div class="line">$ systemd-analyze critical-chain</div><div class="line"></div><div class="line"># 显示指定服务的启动流</div><div class="line">$ systemd-analyze critical-chain atd.service</div></pre></td></tr></table></figure>
<h3 id="hostnamectl"><a href="#hostnamectl" class="headerlink" title="hostnamectl"></a><strong>hostnamectl</strong></h3><p><strong>作用</strong>：用于查看当前主机的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 显示当前主机的信息</div><div class="line">$ hostnamectl</div><div class="line"></div><div class="line"># 设置主机名。</div><div class="line">$ sudo hostnamectl set-hostname XXX-local-host</div></pre></td></tr></table></figure>
<h3 id="localectl"><a href="#localectl" class="headerlink" title="localectl"></a><strong>localectl</strong></h3><p><strong>作用</strong>：用于查看本地化设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 查看本地化设置</div><div class="line">$ localectl</div><div class="line"></div><div class="line"># 设置本地化参数。</div><div class="line">$ sudo localectl set-locale LANG=en_GB.utf8</div><div class="line">$ sudo localectl set-keymap en_GB</div></pre></td></tr></table></figure>
<h3 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a><strong>timedatectl</strong></h3><p><strong>作用</strong>：用于查看当前时区设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 查看当前时区设置</div><div class="line">$ timedatectl</div><div class="line"></div><div class="line"># 显示所有可用的时区</div><div class="line">$ timedatectl list-timezones                                                                                   </div><div class="line"></div><div class="line"># 设置当前时区</div><div class="line">$ sudo timedatectl set-timezone America/New_York</div><div class="line">$ sudo timedatectl set-time YYYY-MM-DD</div><div class="line">$ sudo timedatectl set-time HH:MM:SS</div></pre></td></tr></table></figure>
<h3 id="loginctl"><a href="#loginctl" class="headerlink" title="loginctl"></a><strong>loginctl</strong></h3><p><strong>作用</strong>：用于查看当前登录的用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 列出当前session</div><div class="line">$ loginctl list-sessions</div><div class="line"></div><div class="line"># 列出当前登录用户</div><div class="line">$ loginctl list-users</div><div class="line"></div><div class="line"># 列出显示指定用户的信息</div><div class="line">$ loginctl show-user local-user</div></pre></td></tr></table></figure>
<h2 id="Unit管理命令"><a href="#Unit管理命令" class="headerlink" title="Unit管理命令"></a><strong>Unit管理命令</strong></h2><h3 id="Unit介绍"><a href="#Unit介绍" class="headerlink" title="Unit介绍"></a><strong>Unit介绍</strong></h3><p>Unit为不同资源的分类，一共有12中资源类型：</p>
<ul>
<li>Service unit：系统服务</li>
<li>Target unit：多个 Unit 构成的一个组</li>
<li>Device Unit：硬件设备</li>
<li>Mount Unit：文件系统的挂载点</li>
<li>Automount Unit：自动挂载点</li>
<li>Path Unit：文件或路径</li>
<li>Scope Unit：不是由 Systemd 启动的外部进程</li>
<li>Slice Unit：进程组</li>
<li>Snapshot Unit：Systemd 快照，可以切回某个快照</li>
<li>Socket Unit：进程间通信的 socket</li>
<li>Swap Unit：swap 文件</li>
<li>Timer Unit：定时器</li>
</ul>
<p><strong>查询命令:systemctl list-units</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 列出正在运行的 Unit</div><div class="line">$ systemctl list-units</div><div class="line"></div><div class="line"># 列出所有Unit，包括没有找到配置文件的或者启动失败的</div><div class="line">$ systemctl list-units --all</div><div class="line"></div><div class="line"># 列出所有没有运行的 Unit</div><div class="line">$ systemctl list-units --all --state=inactive</div><div class="line"></div><div class="line"># 列出所有加载失败的 Unit</div><div class="line">$ systemctl list-units --failed</div><div class="line"></div><div class="line"># 列出所有正在运行的、类型为 service 的 Unit</div><div class="line">$ systemctl list-units --type=service</div></pre></td></tr></table></figure>
<p><strong>状态显示命令:systemctl status</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 显示系统状态</div><div class="line">$ systemctl status</div><div class="line"></div><div class="line"># 显示单个 Unit 的状态</div><div class="line">$ systemctl status neutron-server.service</div></pre></td></tr></table></figure>
<p><strong>管理命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"># 立即启动一个服务</div><div class="line">$ sudo systemctl start neutron-server.service</div><div class="line"></div><div class="line"># 立即停止一个服务</div><div class="line">$ sudo systemctl stop neutron-server.service</div><div class="line"></div><div class="line"># 重启一个服务</div><div class="line">$ sudo systemctl restart neutron-server.service</div><div class="line"></div><div class="line"># 杀死一个服务的所有子进程</div><div class="line">$ sudo systemctl kill neutron-server.service</div><div class="line"></div><div class="line"># 重新加载一个服务的配置文件</div><div class="line">$ sudo systemctl reload neutron-server.service</div><div class="line"></div><div class="line"># 重载所有修改过的配置文件</div><div class="line">$ sudo systemctl daemon-reload</div><div class="line"></div><div class="line"># 显示某个 Unit 的所有底层参数</div><div class="line">$ systemctl show neutron-server.service</div><div class="line"></div><div class="line"># 显示某个 Unit 的指定属性的值</div><div class="line">$ systemctl show -p CPUShares neutron-server.service</div><div class="line"></div><div class="line"># 设置某个 Unit 的指定属性</div><div class="line">$ sudo systemctl set-property httpd.service CPUShares=500</div><div class="line"></div><div class="line"></div><div class="line"># 列出一个 Unit 的所有依赖</div><div class="line">systemctl list-dependencies nginx.service</div><div class="line"></div><div class="line"># 列出所有配置文件</div><div class="line">$ systemctl list-unit-files</div><div class="line"></div><div class="line"># 列出指定类型的配置文件</div><div class="line">$ systemctl list-unit-files --type=service</div><div class="line"></div><div class="line"># 命令可以查看配置文件的内容</div><div class="line">$ systemctl cat httpd.service</div></pre></td></tr></table></figure>
<h2 id="日志管理命令"><a href="#日志管理命令" class="headerlink" title="日志管理命令"></a><strong>日志管理命令</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"># 查看所有日志（默认情况下 ，只保存本次启动的日志）</div><div class="line">$ sudo journalctl</div><div class="line"></div><div class="line"># 查看内核日志（不显示应用日志）</div><div class="line">$ sudo journalctl -k</div><div class="line"></div><div class="line"># 查看系统本次启动的日志</div><div class="line">$ sudo journalctl -b</div><div class="line">$ sudo journalctl -b -0</div><div class="line"></div><div class="line"># 查看上一次启动的日志（需更改设置）</div><div class="line">$ sudo journalctl -b -1</div><div class="line"></div><div class="line"># 查看指定时间的日志</div><div class="line">$ sudo journalctl --since=&quot;2012-10-30 18:17:16&quot;</div><div class="line">$ sudo journalctl --since &quot;20 min ago&quot;</div><div class="line">$ sudo journalctl --since yesterday</div><div class="line">$ sudo journalctl --since &quot;2015-01-10&quot; --until &quot;2015-01-11 03:00&quot;</div><div class="line">$ sudo journalctl --since 09:00 --until &quot;1 hour ago&quot;</div><div class="line"></div><div class="line"># 显示尾部的最新10行日志</div><div class="line">$ sudo journalctl -n</div><div class="line"></div><div class="line"># 显示尾部指定行数的日志</div><div class="line">$ sudo journalctl -n 20</div><div class="line"></div><div class="line"># 实时滚动显示最新日志</div><div class="line">$ sudo journalctl -f</div><div class="line"></div><div class="line"># 查看指定服务的日志</div><div class="line">$ sudo journalctl /usr/lib/systemd/systemd</div><div class="line"></div><div class="line"># 查看指定进程的日志</div><div class="line">$ sudo journalctl _PID=1</div><div class="line"></div><div class="line"># 查看某个路径的脚本的日志</div><div class="line">$ sudo journalctl /usr/bin/bash</div><div class="line"></div><div class="line"># 查看指定用户的日志</div><div class="line">$ sudo journalctl _UID=33 --since today</div><div class="line"></div><div class="line"># 查看某个 Unit 的日志</div><div class="line">$ sudo journalctl -u nginx.service</div><div class="line">$ sudo journalctl -u nginx.service --since today</div><div class="line"></div><div class="line"># 实时滚动显示某个 Unit 的最新日志</div><div class="line">$ sudo journalctl -u nginx.service -f</div><div class="line"></div><div class="line"># 合并显示多个 Unit 的日志</div><div class="line">$ journalctl -u nginx.service -u php-fpm.service --since today</div><div class="line"></div><div class="line"># 查看指定优先级（及其以上级别）的日志，共有8级</div><div class="line"># 0: emerg</div><div class="line"># 1: alert</div><div class="line"># 2: crit</div><div class="line"># 3: err</div><div class="line"># 4: warning</div><div class="line"># 5: notice</div><div class="line"># 6: info</div><div class="line"># 7: debug</div><div class="line">$ sudo journalctl -p err -b</div><div class="line"></div><div class="line"># 日志默认分页输出，--no-pager 改为正常的标准输出</div><div class="line">$ sudo journalctl --no-pager</div><div class="line"></div><div class="line"># 以 JSON 格式（单行）输出</div><div class="line">$ sudo journalctl -b -u nginx.service -o json</div><div class="line"></div><div class="line"># 以 JSON 格式（多行）输出，可读性更好</div><div class="line">$ sudo journalctl -b -u nginx.serviceqq</div><div class="line"> -o json-pretty</div><div class="line"></div><div class="line"># 显示日志占据的硬盘空间</div><div class="line">$ sudo journalctl --disk-usage</div><div class="line"></div><div class="line"># 指定日志文件占据的最大空间</div><div class="line">$ sudo journalctl --vacuum-size=1G</div><div class="line"></div><div class="line"># 指定日志文件保存多久</div><div class="line">$ sudo journalctl --vacuum-time=1years</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/13/2017-06-13-neutron-mtu/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/13/2017-06-13-neutron-mtu/" itemprop="url">
                  neutron中的MTU原理详解以及trouble shooting
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-13T17:21:49+08:00">
                2017-06-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/云计算/" itemprop="url" rel="index">
                    <span itemprop="name">云计算</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h1 id="neutron的MTU原理结构"><a href="#neutron的MTU原理结构" class="headerlink" title="neutron的MTU原理结构"></a><strong>neutron的MTU原理结构</strong></h1><p>这个主要从openstack的各个节点开始来说明，包括计算节点，网络节点，为了更好的符合实际的应用环境，这里加入了负载均衡LB节点，在实际使用虚机的时候，是先创建一个负载均衡器，再将创建的虚机<br>加入到负载均衡器的资源池中去。在neutron中配置MTU的文件有neutron.conf中的<em>advertise_mtu</em>，ml2_config.ini中的<em>path_mtu</em>，dhcp_agent.ini中的<em>network_device_mtu</em>，以及openvswitch_agent.ini<br>中的<em>veth_mtu</em>，上述的配置项的默认值为1500，也就是说在创建路由qrouter的时候，内网的网管端口会默认减50，即1450，这主要是为了配置VXLAN的网络会有VXLAN的网络包头（20的IP头+8个UDP+8个VXLAN+<br>14个以太网的头），这个打上VXLAN的数据包就为1500，这正好符合物理网卡以及物理交换机的默认MTU配置。但是负载均衡节点需要配置1450还是1500呢，配置不同会出现什么问题呢，这个会在后续进行详细的<br>说明。</p>
<h2 id="虚机的网络流向路径"><a href="#虚机的网络流向路径" class="headerlink" title="虚机的网络流向路径"></a><strong>虚机的网络流向路径</strong></h2><ul>
<li>虚机地址：10.0.10.4</li>
<li>qrouter的外网网关地址：56.6.6.238</li>
<li>负载均衡的VIP地址：10.100.0.5</li>
<li>qr-vm：10.0.10.1</li>
<li>qr-lb：10.100.0.1</li>
</ul>
<p>具体的实现逻辑如下图所示：</p>
<img src="/images/neutron-mtu/principle.JPG">
<p>这里主要描述了VXLAN的场景下的网络节点、计算节点和lb节点的网桥配置情况，虚机的网络为非SNAT，不需要配置floating IP而是直接连接外网。有关VXLN的具体的网络流量以及封装包的原理请参照<a href="https://chenghuiyu.github.io/2016/07/11/2016-07-11-understanding-neutron-vlan-vxlan/" target="_blank" rel="external">这里</a>,<br>这里就不在进行详述了。但是在增加了负载均衡节点后会一些区别，主要是虚机除外网流量以及外面互联网访问虚机的情况。</p>
<h3 id="虚机出外网"><a href="#虚机出外网" class="headerlink" title="虚机出外网"></a><strong>虚机出外网</strong></h3><img src="/images/neutron-mtu/vm-ext.JPG">
<p>网络流量的流向如上图所示，在虚机的到达网络节点后，先找到自己的网关qr-vm，然后再到VIP的网关qr-lb，网络节点将qr-lb的网络流量转到lb节点的负载均衡命名空间里面去，然后负载均衡节点再将网络<br>流量转到网络节点的qg上去，通过这个外网网关出去，到达互联网。</p>
<h3 id="外网进虚机"><a href="#外网进虚机" class="headerlink" title="外网进虚机"></a><strong>外网进虚机</strong></h3><img src="/images/neutron-mtu/ext-vm.JPG">
<p>这个过程和虚机出互联网的过程类似，外网的流量首先到达虚拟路由的外部网关出口qg，然后qg将网络流量转到VIP的接口qr-lb，然后网络节点将该网包转到lb节点的负载均衡命名空间里面去，lb节点再将<br>该网包转到qr-lb，通过路由的下一跳转到qr-vm，网络节点再将该网报转到计算节点的虚机里面去，这样外网的网络流量就可以到达虚机去。</p>
<h2 id="neutron的MTU机制详解"><a href="#neutron的MTU机制详解" class="headerlink" title="neutron的MTU机制详解"></a><strong>neutron的MTU机制详解</strong></h2><p>这里主要针对负载均衡器的MTU进行了分类，分别将该MTU设为1450和1500来对MTU转发出现的典型问题进行分析。</p>
<h3 id="TCP中的MTU机制"><a href="#TCP中的MTU机制" class="headerlink" title="TCP中的MTU机制"></a><strong>TCP中的MTU机制</strong></h3><p>MTU为TCP中的最大传输单元，而和MTU相关的是MSS（Maximum Segment Size），每个连接方通常在通信的第一个报文段（为建立连接而设置的SYN标志的那个段）中指明这个选项，它指本段所接受的最大长度的报文段。一般来说：<em>MTU=MSS + 20（IP头）+ 20（TCP头）</em>，在开启路径MTU的时候，PMTU发现在IIP首部中继承并设置“不要分片（DF）”比特，来发现当前路径上的路由器是否需要对正在发送的IP数据报进行分片。如果一个待转发的IP数据报被设置DF比特，而其长度又超过了MTU，那么路由器将返回ICMP不可达的差错，如下图所示。当发送数据包的远端接收到这个ICMP的差错报文后，TCP就减少段大小并进行重传。如果路由器产生的是一个较新的该类ICMP差错，则报文段大小被设置为下一跳的MTU减去IP和TCP的首部长度。如果是一个较旧的该类ICMP差错，则必须尝试下一个可能的最小MTU。当由这个ICMP差错引起的重传发生时，拥塞窗口不需要变化，但要启动慢启动。</p>
<img src="/images/neutron-mtu/icmp-unreachable.JPG">
<p>具体实现流程如下所示：</p>
<img src="/images/neutron-mtu/mtuIcmp.JPG">
<h3 id="存在的隐患"><a href="#存在的隐患" class="headerlink" title="存在的隐患"></a><strong>存在的隐患</strong></h3><p>MTU设置不对，导致的结果就是网络不通，外面的服务器不能够访问目的主机，如果目的主机启动了Apache服务，那么80端口就不能进行直接访问，导致业务中断。对于某些业务场景来说，客户端强制对数据包进行不分片（分片会增加数据包的重传率，一旦分片数据包丢失掉一个或者顺序传输错误都会导致重传），也就是会开启PMTU机制，发送的数据包会将flag的DF置为1，那么在整个TCP建立的路径上，不会因为MTU限制而对数据包进行分片。</p>
<p>-&gt; PMTU在一些比较复杂的实际网络环境中会失效，因为为了安全起见，有些网络管理员会在路由器、防火墙等中间设备上设置过滤ICMP报文的安全策略，这将导致ICMP的差错报文会被中间设备丢弃，从而无法到达发送方，这就会导致发送方一直进行数据包的重传，如下所示：</p>
<img src="/images/neutron-mtu/resending.JPG">
<p>而在接收方这边转包的话会发现一直在重复发送ICMP的数据包：</p>
<img src="/images/neutron-mtu/resendingicmp.JPG">
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a><strong>解决方法</strong></h4><ul>
<li><p>开启路由接口的<em>ip tcp adjust-mss<500-1460></500-1460></em>功能，让路由器可以根据自己接口的MTU来修改client端中，SYN的options里面的MSS值，但是这个修改动作对client是不感知的，同理，如果server回复ACK和SYN，路由接口也会修改SYN的options里面的MSS值，改为自己的，这个对server端也是不会感知的。</p>
</li>
<li><p>直接将server的MTU改为和路径路由最小MTU一样，这样就不会发送ICMP不可达报文了，直接从根源解决上述问题</p>
</li>
</ul>
<h3 id="1500的MTU场景"><a href="#1500的MTU场景" class="headerlink" title="1500的MTU场景"></a><strong>1500的MTU场景</strong></h3><p>在该场景下，由于虚拟路由器的MTU小于负载均衡命名空间的MTU，所以协商后的外网发出的MSS以负载均衡的为准，即MSS=1460，那么就会有ICMP数据包的重传，这样如果中间有网络设备将该ICMP拦截，那么就有可能<br>导致通信失败。对于虚拟路由器来说，并不具备传统硬件路由设备的<em>tcp adjust-mss</em>功能，那么只能通过减小负载均衡的MTU值来解决问题。</p>
<img src="/images/neutron-mtu/lbmtu-1500.JPG">
<h3 id="1450的MTU场景"><a href="#1450的MTU场景" class="headerlink" title="1450的MTU场景"></a><strong>1450的MTU场景</strong></h3><p>这样协商的结果就是MSS=1410，不会有ICMP的差错报文。</p>
<img src="/images/neutron-mtu/lbmtu-1450.JPG">

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/01/2017-04-01-odl-install/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="yuchenghui">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="于成辉的技术博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="于成辉的技术博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/01/2017-04-01-odl-install/" itemprop="url">
                  OpenDayLight环境配置和安装使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-01T09:12:53+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SDN/" itemprop="url" rel="index">
                    <span itemprop="name">SDN</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ul>
<li>操作系统：CentOS7</li>
<li>内存：2G</li>
<li>磁盘容量：50G</li>
</ul>
<h2 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a><strong>基础环境配置</strong></h2><p>odl是基于Java虚拟机的，所以要想安装odl，首先需要配置Java环境，为了后续开发使用odl的方便，由于CentOS上默认安装的是openJDK，为了方便使用java的IDEA配置，避免缺少jar包的问题，需要卸载openjdk，再重新从官网上下载最新版本的jdk，进行安装。</p>
<h3 id="首先执行命令查看已经安装过的JDK"><a href="#首先执行命令查看已经安装过的JDK" class="headerlink" title="首先执行命令查看已经安装过的JDK"></a><strong>首先执行命令查看已经安装过的JDK</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qa | grep java</div></pre></td></tr></table></figure>
<p>安装jdk后的目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">java</div><div class="line">java-1.7.0</div><div class="line">java-1.7.0-openjdk.x86_64</div><div class="line">java-1.7.0-openjdk-1.7.0.55.x86_64</div><div class="line">java-openjdk</div><div class="line">jre</div><div class="line">jre-1.7.0</div><div class="line">jre-1.7.0-openjdk.x86_64</div><div class="line">jre-openjdk</div></pre></td></tr></table></figure></p>
<h3 id="卸载jdk"><a href="#卸载jdk" class="headerlink" title="卸载jdk"></a><strong>卸载jdk</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y remove java java-1.7.0-openjdk-devel.x86_64</div><div class="line">yum -y remove java java-1.8.0-openjdk-devel.x86_64</div></pre></td></tr></table></figure>
<h3 id="安装OracleJDK"><a href="#安装OracleJDK" class="headerlink" title="安装OracleJDK"></a><strong>安装OracleJDK</strong></h3><p>从<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">官网</a>上下载最新版的jdk的rpm包，进行安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh jdk-7u60-linux-x64.rpm</div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：OracleJDK默认安装路径为 /usr/java/</p>
</blockquote>
<h3 id="配置Java环境变量"><a href="#配置Java环境变量" class="headerlink" title="配置Java环境变量"></a><strong>配置Java环境变量</strong></h3><p>方法一：只对当前用户有效（建议使用）</p>
<p>vim ~/.bashrc  添加下面内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">JAVA_HOME=/usr/java/jdk1.8.0_92</div><div class="line">CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib</div><div class="line">JRE_HOME=/usr/java/jdk1.8.0_92/jre</div><div class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</div><div class="line">#  CLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</div><div class="line">export JAVA_HOME JRE_HOME PATH CLASSPATH</div></pre></td></tr></table></figure></p>
<p>保存后重新启动，使之有效<br>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">echo $JAVA_HOME</div><div class="line">java -version</div></pre></td></tr></table></figure></p>
<p>方法二：对所有用户有效（谨慎使用）<br>需要在root用户下执行</p>
<p>vi  /etc/profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">JAVA_HOME=/usr/java/jdk1.8.0_92</div><div class="line">CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib</div><div class="line">JRE_HOME=/usr/java/jdk1.8.0_92/jre</div><div class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</div><div class="line">#  CLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</div><div class="line">export JAVA_HOME JRE_HOME PATH CLASSPATH</div></pre></td></tr></table></figure></p>
<p>保存后，重新启动<br>安装完毕</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a><strong>安装</strong></h2><h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a><strong>下载安装包</strong></h3><p>opendaylight安装过程比较简单，先从<a href="https://www.opendaylight.org/downloads" target="_blank" rel="external">官网</a>上下载最新版本的安装包，这里下载的是Boron-SR2版本，下载完成后，进行解压：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tar -zxvf distribution-karaf-0.5.2-Boron-SR2.tar.gz</div><div class="line">cd distribution-karaf-0.5.2-Boron-SR2</div></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./bin/karaf</div></pre></td></tr></table></figure>
<img src="/images/odl-install/1.jpg">
<h3 id="安装组件"><a href="#安装组件" class="headerlink" title="安装组件"></a><strong>安装组件</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">opendaylight-user@root&gt;feature:install odl-restconf odl-l2switch-switch odl-openflowplugin-all odl-mdsal-apidocs odl-dlux-all</div></pre></td></tr></table></figure>
<blockquote>
<p><em>注意</em>：需要安装组件的顺序进行安装，否则可能出现web界面无法访问的问题，无法登陆进入odl界面。<br><em>解决方法</em>：通过logout退出karaf平台，进入上级目录，删除data目录：rm –r data，进入bin目录：cd bin，执行./karaf clean，再次重复上面的安装组件操作。</p>
</blockquote>
<h2 id="界面登陆"><a href="#界面登陆" class="headerlink" title="界面登陆"></a><strong>界面登陆</strong></h2><h3 id="web界面"><a href="#web界面" class="headerlink" title="web界面"></a><strong>web界面</strong></h3><p>安装成功上述组件后就可以正常登陆web界面了，直接登陆：<a href="http://[HOST_IP]:8181/index.html" target="_blank" rel="external">http://[HOST_IP]:8181/index.html</a><br>用户名：admin<br>密码：admin</p>
<p>就可以正常访问了web界面了。</p>
<img src="/images/odl-install/web.jpg">
<h3 id="web控制台界面"><a href="#web控制台界面" class="headerlink" title="web控制台界面"></a><strong>web控制台界面</strong></h3><p>要想登陆odl的web界面，需要安装下面的组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">opendaylight-user@root&gt;feature:install webconsole</div></pre></td></tr></table></figure>
<p>然后登陆：<a href="http://[HOST_IP]:8181/system/console" target="_blank" rel="external">http://[HOST_IP]:8181/system/console</a><br>用户名：karaf<br>密码：karaf</p>
<img src="/images/odl-install/console.jpg">
<h3 id="API查看器"><a href="#API查看器" class="headerlink" title="API查看器"></a><strong>API查看器</strong></h3><p>为了方便查看odl的各种各样的RESTful API，odl还提供了API的查看界面，需要安装以下组件进行登陆。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">opendaylight-user@root&gt;feature:install odl-mdsal-apidocs</div></pre></td></tr></table></figure>
<p>然后登陆：<a href="http://[HOST_IP]:8181/apidoc/explorer/index.html" target="_blank" rel="external">http://[HOST_IP]:8181/apidoc/explorer/index.html</a><br>用户名：karaf<br>密码：karaf</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="yuchenghui" />
          <p class="site-author-name" itemprop="name">yuchenghui</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">39</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuchenghui</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  


</body>
</html>
